{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ViewDetails = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _antd = require(\"antd\");\n\nvar _icons = require(\"@ant-design/icons\");\n\nvar _reactQuery = require(\"react-query\");\n\nvar _reactUtils = require(\"@opensrp/react-utils\");\n\nvar _constants = require(\"../../constants\");\n\nvar _mls = require(\"../../mls\");\n\nvar _lodash = require(\"lodash\");\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      \"default\": obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj[\"default\"] = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction categorizeIncludedResources(resources, careTeamId) {\n  var _thisCareTeam$subject, _thisCareTeam$partici, _thisCareTeam$managin;\n\n  var resByIds = (0, _lodash.keyBy)(resources, function (resource) {\n    return \"\".concat(resource.resourceType, \"/\").concat(resource.id);\n  });\n  var thisCareTeam = resByIds[\"\".concat(_constants.careTeamResourceType, \"/\").concat(careTeamId)];\n  var subjectRef = (_thisCareTeam$subject = thisCareTeam.subject) === null || _thisCareTeam$subject === void 0 ? void 0 : _thisCareTeam$subject.reference;\n  var subjectResource = subjectRef ? resByIds[subjectRef] : undefined;\n  var participants = [];\n  var managingOrganizations = [];\n  (_thisCareTeam$partici = thisCareTeam.participant) === null || _thisCareTeam$partici === void 0 ? void 0 : _thisCareTeam$partici.forEach(function (participant) {\n    var _participant$member;\n\n    var ref = (_participant$member = participant.member) === null || _participant$member === void 0 ? void 0 : _participant$member.reference;\n    var referencedResource = resByIds[ref !== null && ref !== void 0 ? ref : ''];\n\n    if (referencedResource) {\n      participants.push(referencedResource);\n    }\n  });\n  (_thisCareTeam$managin = thisCareTeam.managingOrganization) === null || _thisCareTeam$managin === void 0 ? void 0 : _thisCareTeam$managin.forEach(function (organization) {\n    var ref = organization.reference;\n    var referencedResource = resByIds[ref !== null && ref !== void 0 ? ref : ''];\n\n    if (referencedResource) {\n      managingOrganizations.push(referencedResource);\n    }\n  });\n  var participantByResourceType = (0, _lodash.groupBy)(participants, 'resourceType');\n  return {\n    subjectResource: subjectResource,\n    participantByResourceType: participantByResourceType,\n    thisCareTeam: thisCareTeam,\n    managingOrganizations: managingOrganizations\n  };\n}\n\nvar ViewDetails = function ViewDetails(props) {\n  var _careTeamKeyValues;\n\n  var careTeamId = props.careTeamId,\n      fhirBaseURL = props.fhirBaseURL;\n\n  var _useTranslation = (0, _mls.useTranslation)(),\n      t = _useTranslation.t;\n\n  var _useSearchParams = (0, _reactUtils.useSearchParams)(),\n      removeParam = _useSearchParams.removeParam;\n\n  var _useQuery = (0, _reactQuery.useQuery)({\n    queryKey: [_constants.careTeamResourceType, careTeamId],\n    queryFn: function queryFn() {\n      return new _reactUtils.FHIRServiceClass(fhirBaseURL, _constants.careTeamResourceType).list({\n        _id: careTeamId,\n        _include: \"\".concat(_constants.careTeamResourceType, \":*\")\n      });\n    },\n    enabled: !!careTeamId,\n    select: function select(res) {\n      var resEntries = (0, _reactUtils.getResourcesFromBundle)(res);\n      return categorizeIncludedResources(resEntries, careTeamId);\n    }\n  }),\n      data = _useQuery.data,\n      isLoading = _useQuery.isLoading,\n      error = _useQuery.error;\n\n  var careTeam = data === null || data === void 0 ? void 0 : data.thisCareTeam;\n  var participantByResourceType = data === null || data === void 0 ? void 0 : data.participantByResourceType;\n  var managingOrganizations = data === null || data === void 0 ? void 0 : data.managingOrganizations;\n  var officialIdentifier = (0, _reactUtils.getObjLike)(careTeam === null || careTeam === void 0 ? void 0 : careTeam.identifier, 'use', _reactUtils.IdentifierUseCodes.OFFICIAL);\n  var careTeamKeyValues = (_careTeamKeyValues = {}, (0, _defineProperty2[\"default\"])(_careTeamKeyValues, t('CareTeam ID'), careTeam === null || careTeam === void 0 ? void 0 : careTeam.id), (0, _defineProperty2[\"default\"])(_careTeamKeyValues, t('Identifier'), (0, _lodash.get)(officialIdentifier, '0.value')), (0, _defineProperty2[\"default\"])(_careTeamKeyValues, t('Name'), careTeam === null || careTeam === void 0 ? void 0 : careTeam.name), (0, _defineProperty2[\"default\"])(_careTeamKeyValues, t('status'), careTeam === null || careTeam === void 0 ? void 0 : careTeam.status), (0, _defineProperty2[\"default\"])(_careTeamKeyValues, t('Participants'), _react[\"default\"].createElement(\"ul\", null, Object.entries(participantByResourceType !== null && participantByResourceType !== void 0 ? participantByResourceType : {}).map(function (_ref, index) {\n    var _ref2 = (0, _slicedToArray2[\"default\"])(_ref, 2),\n        resourceType = _ref2[0],\n        resources = _ref2[1];\n\n    return _react[\"default\"].createElement(\"li\", {\n      key: index\n    }, function () {\n      var subKeyValues = (0, _defineProperty2[\"default\"])({}, resourceType, _react[\"default\"].createElement(\"ul\", {\n        id: \"care-team-participants\"\n      }, resources.map(function (resource) {\n        var res = resource;\n        var practitionerName = (0, _reactUtils.getObjLike)(res.name, 'use', _reactUtils.IdentifierUseCodes.OFFICIAL)[0];\n        return _react[\"default\"].createElement(\"li\", {\n          key: resource.id\n        }, typeof res.name === 'string' ? res.name : (0, _reactUtils.parseFhirHumanName)(practitionerName));\n      })));\n      return _react[\"default\"].createElement(_react.Fragment, {\n        key: index\n      }, resources.length && (0, _reactUtils.renderObjectAsKeyvalue)(subKeyValues));\n    }());\n  }))), (0, _defineProperty2[\"default\"])(_careTeamKeyValues, t('Managing organizations'), managingOrganizations !== null && managingOrganizations !== void 0 && managingOrganizations.length ? _react[\"default\"].createElement(\"ul\", {\n    id: \"managing-organizations\"\n  }, managingOrganizations.map(function (organization) {\n    return _react[\"default\"].createElement(\"li\", {\n      key: organization.id\n    }, organization.name);\n  })) : _react[\"default\"].createElement(_antd.Alert, {\n    description: t('No managing organizations found'),\n    type: \"warning\"\n  })), _careTeamKeyValues);\n  return _react[\"default\"].createElement(_antd.Col, {\n    className: \"view-details-content\"\n  }, _react[\"default\"].createElement(\"div\", {\n    className: \"flex-right\"\n  }, _react[\"default\"].createElement(_antd.Button, {\n    \"data-testid\": \"cancel\",\n    icon: _react[\"default\"].createElement(_icons.CloseOutlined, null),\n    shape: \"circle\",\n    type: \"text\",\n    onClick: function onClick() {\n      return removeParam(_reactUtils.viewDetailsQuery);\n    }\n  })), error && !data ? _react[\"default\"].createElement(_reactUtils.BrokenPage, {\n    errorMessage: \"\".concat(error)\n  }) : _react[\"default\"].createElement(_react[\"default\"].Fragment, null, isLoading ? _react[\"default\"].createElement(_antd.Alert, {\n    description: t('Fetching Care team'),\n    type: \"info\",\n    showIcon: true,\n    icon: _react[\"default\"].createElement(_icons.SyncOutlined, {\n      spin: true\n    })\n  }) : careTeam ? (0, _reactUtils.renderObjectAsKeyvalue)(careTeamKeyValues) : _react[\"default\"].createElement(_antd.Alert, {\n    description: t('Care Team not found'),\n    type: \"warning\"\n  })));\n};\n\nexports.ViewDetails = ViewDetails;","map":null,"metadata":{},"sourceType":"script"}