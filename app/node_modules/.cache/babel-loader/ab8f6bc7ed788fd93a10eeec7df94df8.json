{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.handleTransferChange = exports.defaultProps = exports.defaultInitialValues = exports.UserGroupForm = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactRouter = require(\"react-router\");\n\nvar _antd = require(\"antd\");\n\nvar _reactUtils = require(\"@opensrp/react-utils\");\n\nvar _reduxReducerRegistry = _interopRequireDefault(require(\"@onaio/redux-reducer-registry\"));\n\nvar _notifications = require(\"@opensrp/notifications\");\n\nvar _constants = require(\"../../constants\");\n\nvar _mls = require(\"../../mls\");\n\nvar _utils = require(\"./utils\");\n\nvar _userRoles = require(\"../../ducks/userRoles\");\n\nrequire(\"./form.css\");\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      \"default\": obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj[\"default\"] = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      (0, _defineProperty2[\"default\"])(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\n_reduxReducerRegistry[\"default\"].register(_userRoles.reducerName, _userRoles.reducer);\n\nvar defaultInitialValues = {\n  access: {\n    view: false,\n    manage: false,\n    manageMembership: false\n  },\n  attributes: {},\n  clientRoles: {},\n  id: '',\n  name: '',\n  path: '',\n  realmRoles: [],\n  subGroups: []\n};\nexports.defaultInitialValues = defaultInitialValues;\nvar defaultProps = {\n  allRoles: [],\n  assignedRoles: [],\n  availableRoles: [],\n  initialValues: defaultInitialValues,\n  keycloakBaseURL: ''\n};\nexports.defaultProps = defaultProps;\n\nvar handleTransferChange = function () {\n  var _ref = (0, _asyncToGenerator2[\"default\"])(_regenerator[\"default\"].mark(function _callee(initialValues, targetSelectedKeys, sourceSelectedKeys, keycloakBaseURL, roles, t) {\n    return _regenerator[\"default\"].wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!targetSelectedKeys.length) {\n              _context.next = 5;\n              break;\n            }\n\n            _context.next = 3;\n            return (0, _utils.removeAssignedRoles)(initialValues.id, keycloakBaseURL, roles, targetSelectedKeys, t);\n\n          case 3:\n            _context.next = 8;\n            break;\n\n          case 5:\n            if (!sourceSelectedKeys.length) {\n              _context.next = 8;\n              break;\n            }\n\n            _context.next = 8;\n            return (0, _utils.assignRoles)(initialValues.id, keycloakBaseURL, roles, sourceSelectedKeys, t);\n\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function handleTransferChange(_x, _x2, _x3, _x4, _x5, _x6) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.handleTransferChange = handleTransferChange;\n\nvar UserGroupForm = function UserGroupForm(props) {\n  var initialValues = props.initialValues,\n      keycloakBaseURL = props.keycloakBaseURL,\n      assignedRoles = props.assignedRoles,\n      availableRoles = props.availableRoles,\n      allRoles = props.allRoles;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isSubmitting = _useState2[0],\n      setIsSubmitting = _useState2[1];\n\n  var _useState3 = (0, _react.useState)([]),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      sourceSelectedKeys = _useState4[0],\n      setSourceSelectedKeys = _useState4[1];\n\n  var _useState5 = (0, _react.useState)([]),\n      _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n      targetSelectedKeys = _useState6[0],\n      setTargetSelectedKeys = _useState6[1];\n\n  var _useState7 = (0, _react.useState)([]),\n      _useState8 = (0, _slicedToArray2[\"default\"])(_useState7, 2),\n      targetKeys = _useState8[0],\n      setTargetKeys = _useState8[1];\n\n  var history = (0, _reactRouter.useHistory)();\n\n  var _Form$useForm = _antd.Form.useForm(),\n      _Form$useForm2 = (0, _slicedToArray2[\"default\"])(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var _useTranslation = (0, _mls.useTranslation)(),\n      t = _useTranslation.t;\n\n  var layout = {\n    labelCol: {\n      xs: {\n        offset: 0,\n        span: 16\n      },\n      sm: {\n        offset: 2,\n        span: 10\n      },\n      md: {\n        offset: 0,\n        span: 8\n      },\n      lg: {\n        offset: 0,\n        span: 6\n      }\n    },\n    wrapperCol: {\n      xs: {\n        span: 24\n      },\n      sm: {\n        span: 14\n      },\n      md: {\n        span: 12\n      },\n      lg: {\n        span: 10\n      }\n    }\n  };\n  var tailLayout = {\n    wrapperCol: {\n      xs: {\n        offset: 0,\n        span: 16\n      },\n      sm: {\n        offset: 12,\n        span: 24\n      },\n      md: {\n        offset: 8,\n        span: 16\n      },\n      lg: {\n        offset: 6,\n        span: 14\n      }\n    }\n  };\n\n  _react[\"default\"].useEffect(function () {\n    form.setFieldsValue(_objectSpread({}, initialValues));\n  }, [form, initialValues]);\n\n  var onChange = function () {\n    var _ref2 = (0, _asyncToGenerator2[\"default\"])(_regenerator[\"default\"].mark(function _callee2(nextTargetKeys) {\n      return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              handleTransferChange(initialValues, targetSelectedKeys, sourceSelectedKeys, keycloakBaseURL, allRoles, t)[\"finally\"](function () {\n                return setTargetKeys(nextTargetKeys);\n              });\n\n            case 1:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onChange(_x7) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onSelectChange = function onSelectChange(sourceSelectedKeys, targetSelectedKeys) {\n    setSourceSelectedKeys((0, _toConsumableArray2[\"default\"])(sourceSelectedKeys));\n    setTargetSelectedKeys((0, _toConsumableArray2[\"default\"])(targetSelectedKeys));\n  };\n\n  var data = [].concat((0, _toConsumableArray2[\"default\"])(assignedRoles), (0, _toConsumableArray2[\"default\"])(availableRoles)).map(function (item) {\n    return {\n      key: item.id,\n      title: item.name\n    };\n  });\n  var name = initialValues.name;\n  return _react[\"default\"].createElement(_antd.Row, {\n    className: \"content-section user-group\"\n  }, _react[\"default\"].createElement(_reactUtils.PageHeader, {\n    title: props.initialValues.id ? t('Edit User Group | {{name}}', {\n      name: name\n    }) : t('New User Group')\n  }), _react[\"default\"].createElement(_antd.Col, {\n    className: \"bg-white p-3\",\n    span: 24\n  }, _react[\"default\"].createElement(_antd.Form, (0, _extends2[\"default\"])({}, layout, {\n    form: form,\n    initialValues: _objectSpread({}, initialValues),\n    onFinish: function onFinish(values) {\n      delete values.roles;\n      setIsSubmitting(true);\n      (0, _utils.submitForm)(_objectSpread(_objectSpread({}, initialValues), values), keycloakBaseURL, setIsSubmitting, t)[\"catch\"](function () {\n        return (0, _notifications.sendErrorNotification)(t('There was a problem submitting the form'));\n      });\n    }\n  }), _react[\"default\"].createElement(_antd.Form.Item, {\n    name: \"name\",\n    id: \"name\",\n    label: t('Name'),\n    rules: [{\n      required: true,\n      message: t('Name is required')\n    }]\n  }, _react[\"default\"].createElement(_antd.Input, null)), initialValues.id ? _react[\"default\"].createElement(_antd.Form.Item, {\n    name: \"roles\",\n    id: \"roles\",\n    label: t('Realm Roles')\n  }, _react[\"default\"].createElement(_antd.Transfer, {\n    dataSource: data,\n    titles: [t('Available Roles'), t('Assigned Roles')],\n    listStyle: {\n      minWidth: 300,\n      minHeight: 300\n    },\n    targetKeys: targetKeys.length ? targetKeys : assignedRoles.map(function (role) {\n      return role.id;\n    }),\n    selectedKeys: [].concat((0, _toConsumableArray2[\"default\"])(sourceSelectedKeys), (0, _toConsumableArray2[\"default\"])(targetSelectedKeys)),\n    render: function render(item) {\n      return _react[\"default\"].createElement(\"div\", null, item.title);\n    },\n    disabled: false,\n    onChange: onChange,\n    onSelectChange: onSelectChange,\n    locale: {\n      notFoundContent: t('The list is empty'),\n      searchPlaceholder: t('Search')\n    }\n  })) : '', _react[\"default\"].createElement(_antd.Form.Item, tailLayout, _react[\"default\"].createElement(_antd.Button, {\n    type: \"primary\",\n    htmlType: \"submit\",\n    className: \"create-group\"\n  }, isSubmitting ? t('Saving') : t('Save')), _react[\"default\"].createElement(_antd.Button, {\n    onClick: function onClick() {\n      return history.push(_constants.URL_USER_GROUPS);\n    },\n    className: \"cancel-group\"\n  }, t('Cancel'))))));\n};\n\nexports.UserGroupForm = UserGroupForm;\nUserGroupForm.defaultProps = defaultProps;","map":null,"metadata":{},"sourceType":"script"}