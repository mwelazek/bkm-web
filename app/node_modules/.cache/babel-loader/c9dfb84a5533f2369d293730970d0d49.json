{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.deleteCommodity = exports.CommodityList = void 0;\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _antd = require(\"antd\");\n\nvar _GroupDetail = require(\"../BaseComponents/GroupDetail\");\n\nvar _icons = require(\"@ant-design/icons\");\n\nvar _constants = require(\"../../constants\");\n\nvar _reactRouterDom = require(\"react-router-dom\");\n\nvar _mls = require(\"../../mls\");\n\nvar _BaseGroupsListView = require(\"../BaseComponents/BaseGroupsListView\");\n\nvar _reactUtils = require(\"@opensrp/react-utils\");\n\nvar _lodash = require(\"lodash\");\n\nvar _utils = require(\"../..//helpers/utils\");\n\nvar _reactQuery = require(\"react-query\");\n\nvar _notifications = require(\"@opensrp/notifications\");\n\nvar _rbac = require(\"@opensrp/rbac\");\n\nvar _excluded = [\"permissions\"];\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      (0, _defineProperty2[\"default\"])(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nvar keyValueDetailRender = function keyValueDetailRender(obj, t) {\n  var _keyValues;\n\n  var _parseGroup = (0, _GroupDetail.parseGroup)(obj),\n      name = _parseGroup.name,\n      active = _parseGroup.active,\n      id = _parseGroup.id,\n      identifier = _parseGroup.identifier;\n\n  var unitMeasureCharacteristic = (0, _utils.getUnitMeasureCharacteristic)(obj);\n  var keyValues = (_keyValues = {}, (0, _defineProperty2[\"default\"])(_keyValues, t('Commodity Id'), id), (0, _defineProperty2[\"default\"])(_keyValues, t('Identifier'), identifier), (0, _defineProperty2[\"default\"])(_keyValues, t('Name'), name), (0, _defineProperty2[\"default\"])(_keyValues, t('Active'), active ? t('Active') : t('Disabled')), (0, _defineProperty2[\"default\"])(_keyValues, t('Unit of measure'), (0, _lodash.get)(unitMeasureCharacteristic, 'valueCodeableConcept.text')), _keyValues);\n  return _react[\"default\"].createElement(_antd.Space, {\n    direction: \"vertical\"\n  }, Object.entries(keyValues).map(function (_ref) {\n    var _ref2 = (0, _slicedToArray2[\"default\"])(_ref, 2),\n        key = _ref2[0],\n        value = _ref2[1];\n\n    var props = (0, _defineProperty2[\"default\"])({}, key, value);\n    return value ? _react[\"default\"].createElement(\"div\", {\n      key: key,\n      \"data-testid\": \"key-value\"\n    }, _react[\"default\"].createElement(_reactUtils.SingleKeyNestedValue, props)) : null;\n  }));\n};\n\nvar CommodityList = function CommodityList(props) {\n  var fhirBaseURL = props.fhirBaseURL,\n      listId = props.listId;\n\n  var _useTranslation = (0, _mls.useTranslation)(),\n      t = _useTranslation.t;\n\n  var queryClient = (0, _reactQuery.useQueryClient)();\n\n  var _useSearchParams = (0, _reactUtils.useSearchParams)(),\n      addParam = _useSearchParams.addParam;\n\n  var userRole = (0, _rbac.useUserRole)();\n\n  var getItems = function getItems(record) {\n    return [{\n      key: '1',\n      permissions: [],\n      label: _react[\"default\"].createElement(_antd.Button, {\n        \"data-testid\": \"view-details\",\n        onClick: function onClick() {\n          return addParam(_reactUtils.viewDetailsQuery, record.id);\n        },\n        type: \"link\"\n      }, t('View Details'))\n    }, {\n      key: '2',\n      permissions: ['Group.delete'],\n      label: _react[\"default\"].createElement(_antd.Popconfirm, {\n        title: t('Are you sure you want to delete this Commodity?'),\n        okText: t('Yes'),\n        cancelText: t('No'),\n        onConfirm: (0, _asyncToGenerator2[\"default\"])(_regenerator[\"default\"].mark(function _callee() {\n          return _regenerator[\"default\"].wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  deleteCommodity(fhirBaseURL, record.obj, listId).then(function () {\n                    queryClient.invalidateQueries([_constants.groupResourceType])[\"catch\"](function () {\n                      (0, _notifications.sendInfoNotification)(t('Unable to refresh data at the moment, please refresh the page'));\n                    });\n                    (0, _notifications.sendSuccessNotification)(t('Successfully deleted commodity'));\n                  })[\"catch\"](function () {\n                    (0, _notifications.sendErrorNotification)(t('Deletion of commodity failed'));\n                  });\n\n                case 1:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }))\n      }, _react[\"default\"].createElement(_antd.Button, {\n        danger: true,\n        type: \"link\",\n        style: {\n          color: '#'\n        }\n      }, t('Delete')))\n    }].filter(function (item) {\n      return userRole.hasPermissions(item.permissions);\n    }).map(function (item) {\n      var permissions = item.permissions,\n          rest = (0, _objectWithoutProperties2[\"default\"])(item, _excluded);\n      return rest;\n    });\n  };\n\n  var getColumns = function getColumns(t) {\n    return [{\n      title: t('Name'),\n      dataIndex: 'name',\n      key: 'name'\n    }, {\n      title: t('Active'),\n      dataIndex: 'active',\n      key: 'active',\n      render: function render(value) {\n        return _react[\"default\"].createElement(\"div\", null, value ? t('Active') : t('Disabled'));\n      }\n    }, {\n      title: t('type'),\n      dataIndex: 'type',\n      key: 'type'\n    }, {\n      title: t('Actions'),\n      width: '10%',\n      render: function render(_, record) {\n        return _react[\"default\"].createElement(\"span\", {\n          className: \"d-flex align-items-center\"\n        }, _react[\"default\"].createElement(_reactRouterDom.Link, {\n          to: \"\".concat(_constants.ADD_EDIT_COMMODITY_URL, \"/\").concat(record.id),\n          className: \"m-0 p-1\"\n        }, t('Edit')), _react[\"default\"].createElement(_antd.Divider, {\n          type: \"vertical\"\n        }), _react[\"default\"].createElement(_antd.Dropdown, {\n          menu: {\n            items: getItems(record)\n          },\n          placement: \"bottomRight\",\n          arrow: true,\n          trigger: ['click']\n        }, _react[\"default\"].createElement(_icons.MoreOutlined, {\n          \"data-testid\": \"action-dropdown\",\n          className: \"more-options\"\n        })));\n      }\n    }];\n  };\n\n  var baseListViewProps = {\n    getColumns: getColumns,\n    keyValueMapperRenderProp: keyValueDetailRender,\n    createButtonLabel: t('Add Commodity'),\n    createButtonUrl: _constants.ADD_EDIT_COMMODITY_URL,\n    fhirBaseURL: fhirBaseURL,\n    pageTitle: t('Commodity List'),\n    extraQueryFilters: {\n      code: \"\".concat(_utils.snomedCodeSystem, \"|\").concat(_utils.supplyMgSnomedCode),\n      '_has:List:item:_id': listId\n    }\n  };\n  return _react[\"default\"].createElement(_BaseGroupsListView.BaseListView, baseListViewProps);\n};\n\nexports.CommodityList = CommodityList;\n\nvar deleteCommodity = function () {\n  var _ref4 = (0, _asyncToGenerator2[\"default\"])(_regenerator[\"default\"].mark(function _callee2(fhirBaseURL, obj, listId) {\n    var _list$entry;\n\n    var disabledGroup, serve, listServer, list, leftEntries, listPayload;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (listId) {\n              _context2.next = 2;\n              break;\n            }\n\n            throw new Error('List id is not configured correctly');\n\n          case 2:\n            disabledGroup = _objectSpread(_objectSpread({}, obj), {}, {\n              active: false\n            });\n            serve = new _reactUtils.FHIRServiceClass(fhirBaseURL, _constants.groupResourceType);\n            listServer = new _reactUtils.FHIRServiceClass(fhirBaseURL, _constants.listResourceType);\n            _context2.next = 7;\n            return listServer.read(listId);\n\n          case 7:\n            list = _context2.sent;\n            leftEntries = ((_list$entry = list.entry) !== null && _list$entry !== void 0 ? _list$entry : []).filter(function (entry) {\n              return entry.item.reference !== \"\".concat(_constants.groupResourceType, \"/\").concat(obj.id);\n            });\n            listPayload = _objectSpread(_objectSpread({}, list), {}, {\n              entry: leftEntries\n            });\n            return _context2.abrupt(\"return\", listServer.update(listPayload).then(function () {\n              return serve.update(disabledGroup);\n            }));\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function deleteCommodity(_x, _x2, _x3) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexports.deleteCommodity = deleteCommodity;","map":null,"metadata":{},"sourceType":"script"}