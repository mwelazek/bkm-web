{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst extensions_1 = __importDefault(require(\"../constants/extensions\"));\n\nconst index_1 = __importStar(require(\"../constants/index\"));\n\nconst itemcontrol_1 = __importDefault(require(\"../constants/itemcontrol\"));\n\nconst itemType_1 = __importDefault(require(\"../constants/itemType\"));\n\nconst extension_1 = require(\"./extension\");\n\nconst index_2 = require(\"./index\");\n\nfunction hasCanonicalValueSet(item) {\n  return !!item.answerValueSet && item.answerValueSet.substr(0, 4) === 'http';\n}\n\nexports.hasCanonicalValueSet = hasCanonicalValueSet;\n\nfunction hasOptions(item, containedResources) {\n  const options = getOptions(item, containedResources);\n  return !!options && options.length > 0;\n}\n\nexports.hasOptions = hasOptions;\n\nfunction getOptions(item, containedResources) {\n  if (!item) {\n    return undefined;\n  }\n\n  let options;\n\n  if (item.answerValueSet) {\n    if (item.answerValueSet.startsWith('#')) {\n      options = getContainedOptions(item, containedResources);\n    }\n  } else if (item.answerOption) {\n    options = getInlineOptions(item, index_2.isReadOnly(item));\n  } else if (hasExtensionOptions(item)) {\n    options = getExtensionOptions(item, index_2.isReadOnly(item));\n  }\n\n  if (item.type === itemType_1.default.OPENCHOICE) {\n    if (!options) {\n      options = [];\n    }\n\n    options.push({\n      label: index_1.OPEN_CHOICE_LABEL,\n      type: index_1.OPEN_CHOICE_ID\n    });\n  }\n\n  return options;\n}\n\nexports.getOptions = getOptions;\n\nfunction getSystem(item, code, containedResources) {\n  if (item.answerValueSet && item.answerValueSet.startsWith('#')) {\n    const id = item.answerValueSet.replace('#', '');\n    const resource = getContainedResource(id, containedResources);\n\n    if (resource && resource.compose) {\n      return resource.compose.include[0].system;\n    }\n  } else if (item.answerOption && code) {\n    const matchingCode = item.answerOption.filter(x => x.valueCoding && x.valueCoding.code === code);\n    return matchingCode.length > 0 ? matchingCode[0].valueCoding.system : undefined;\n  }\n\n  return undefined;\n}\n\nexports.getSystem = getSystem;\n\nfunction getDisplay(options, value) {\n  if (!options || options.length === 0) {\n    return undefined;\n  }\n\n  let display;\n  options.forEach(o => {\n    if (o.type === value) {\n      display = o.label;\n      return;\n    }\n  });\n  return display;\n}\n\nexports.getDisplay = getDisplay;\n\nfunction renderOptions(item, containedResources, renderRadio, renderCheckbox, renderDropdown, renderAutosuggest) {\n  const itemControlValue = getItemControlValue(item);\n  const options = getOptions(item, containedResources);\n\n  if (hasOptions(item, containedResources) && !hasCanonicalValueSet(item)) {\n    if (itemControlValue) {\n      switch (itemControlValue) {\n        case itemcontrol_1.default.DROPDOWN:\n          return renderDropdown(options);\n\n        case itemcontrol_1.default.CHECKBOX:\n          return renderCheckbox(options);\n\n        case itemcontrol_1.default.RADIOBUTTON:\n          return renderRadio(options);\n\n        default:\n          break;\n      }\n    } else if (isAboveDropdownThreshold(options)) {\n      return renderDropdown(options);\n    }\n\n    return renderRadio(options);\n  } else if (hasCanonicalValueSet(item) && itemControlValue === itemcontrol_1.default.AUTOCOMPLETE) {\n    return renderAutosuggest();\n  }\n\n  return null;\n}\n\nexports.renderOptions = renderOptions;\n\nfunction isAboveDropdownThreshold(options) {\n  if (!options) {\n    return false;\n  }\n\n  return options.length > index_1.default.CHOICE_DROPDOWN_TRESHOLD;\n}\n\nfunction getItemControlValue(item) {\n  const itemControl = extension_1.getItemControlExtensionValue(item);\n\n  if (itemControl) {\n    for (let i = 0; i < itemControl.length; i++) {\n      if (itemControl[i] && itemControl[i].code) {\n        if (itemControl[i].code === itemcontrol_1.default.CHECKBOX) {\n          return itemcontrol_1.default.CHECKBOX;\n        }\n\n        if (itemControl[i].code === itemcontrol_1.default.DROPDOWN) {\n          return itemcontrol_1.default.DROPDOWN;\n        }\n\n        if (itemControl[i].code === itemcontrol_1.default.RADIOBUTTON) {\n          return itemcontrol_1.default.RADIOBUTTON;\n        }\n\n        if (itemControl[i].code === itemcontrol_1.default.AUTOCOMPLETE) {\n          return itemcontrol_1.default.AUTOCOMPLETE;\n        }\n      }\n    }\n  }\n\n  return undefined;\n}\n\nexports.getItemControlValue = getItemControlValue;\n\nfunction getErrorMessage(item, value, resources, containedResources) {\n  if (!resources || !item) {\n    return '';\n  }\n\n  const extensionText = extension_1.getValidationTextExtension(item);\n\n  if (extensionText) {\n    return extensionText;\n  }\n\n  if (!value && index_2.isRequired(item) && resources) {\n    return resources.oppgiVerdi;\n  }\n\n  if (!isAllowedValue(item, value, containedResources)) {\n    return resources.oppgiGyldigVerdi;\n  }\n\n  return '';\n}\n\nexports.getErrorMessage = getErrorMessage;\n\nfunction isAllowedValue(item, value, containedResources) {\n  if (!item) {\n    return true;\n  }\n\n  if (item.answerValueSet || item.answerValueSet) {\n    const allowedValues = getOptions(item, containedResources);\n\n    if (!allowedValues || allowedValues.length === 0) {\n      return true;\n    }\n\n    const matches = allowedValues.filter(a => a.type === value);\n    return matches.length > 0;\n  }\n\n  return true;\n}\n\nexports.isAllowedValue = isAllowedValue;\n\nfunction validateInput(item, value, containedResources) {\n  if (index_2.isRequired(item) && !value) {\n    return false;\n  }\n\n  if (!isAllowedValue(item, value, containedResources)) {\n    return false;\n  }\n\n  return true;\n}\n\nexports.validateInput = validateInput;\n\nfunction getIndexOfAnswer(code, answer) {\n  if (answer && Array.isArray(answer)) {\n    return answer.findIndex(el => {\n      if (el && el.valueCoding && el.valueCoding.code) {\n        return el.valueCoding.code === code;\n      }\n\n      return false;\n    });\n  } else if (answer && !Array.isArray(answer) && answer.valueCoding && answer.valueCoding.code === code) {\n    return 0;\n  }\n\n  return -1;\n}\n\nexports.getIndexOfAnswer = getIndexOfAnswer;\n\nfunction shouldShowExtraChoice(answer) {\n  if (!answer) {\n    return false;\n  }\n\n  if (Array.isArray(answer)) {\n    for (let i = 0; i < answer.length; i++) {\n      const el = answer[i];\n\n      if (el.valueCoding && el.valueCoding.code === index_1.OPEN_CHOICE_ID) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  return !!answer.valueCoding && !!answer.valueCoding.code && answer.valueCoding.code === index_1.OPEN_CHOICE_ID;\n}\n\nexports.shouldShowExtraChoice = shouldShowExtraChoice;\n\nfunction hasExtensionOptions(item) {\n  if (item.extension) {\n    return item.extension.filter(it => it.url === extensions_1.default.OPTION_REFERENCE).length > 0;\n  }\n\n  return false;\n}\n\nfunction getExtensionOptions(item, readOnly) {\n  if (!item || !item.extension) {\n    return undefined;\n  }\n\n  return item.extension.filter(it => it.url === extensions_1.default.OPTION_REFERENCE).map(it => createRadiogroupOptionFromQuestionnaireExtension(it, readOnly)).filter(it => it !== undefined);\n}\n\nfunction getInlineOptions(item, readOnly) {\n  if (!item || !item.answerOption) {\n    return undefined;\n  }\n\n  return item.answerOption.map(it => createRadiogroupOptionFromQuestionnaireOption(it, readOnly)).filter(it => it !== undefined);\n}\n\nfunction createRadiogroupOptionFromQuestionnaireExtension(extension, readOnly) {\n  if (extension.valueReference) {\n    return createRadiogroupOptionFromValueReference(extension.valueReference, readOnly);\n  }\n\n  return undefined;\n}\n\nfunction createRadiogroupOptionFromQuestionnaireOption(option, readOnly) {\n  if (option.valueString) {\n    return createRadiogroupOptionFromValueString(option.valueString, readOnly);\n  } else if (option.valueInteger) {\n    return createRadiogroupOptionFromValueInteger(option.valueInteger, readOnly);\n  } else if (option.valueTime) {\n    return createRadiogroupOptionFromValueTime(option.valueTime, readOnly);\n  } else if (option.valueDate) {\n    return createRadiogroupOptionFromValueDate(option.valueDate, readOnly);\n  } else if (option.valueReference) {\n    return createRadiogroupOptionFromValueReference(option.valueReference, readOnly);\n  } else if (option.valueCoding) {\n    return createRadiogroupOptionFromValueCoding(option.valueCoding, readOnly);\n  }\n\n  return undefined;\n}\n\nfunction createRadiogroupOptionFromValueCoding(coding, readOnly) {\n  return createRadiogroupOption(String(coding.code), String(coding.display), readOnly);\n}\n\nfunction createRadiogroupOptionFromValueReference(reference, readOnly) {\n  return createRadiogroupOption(String(reference.reference), String(reference.display), readOnly);\n}\n\nfunction createRadiogroupOptionFromValueDate(value, readOnly) {\n  return createRadiogroupOption(String(value), String(value), readOnly);\n}\n\nfunction createRadiogroupOptionFromValueTime(value, readOnly) {\n  return createRadiogroupOption(String(value), String(value), readOnly);\n}\n\nfunction createRadiogroupOptionFromValueInteger(value, readOnly) {\n  return createRadiogroupOption(String(value), String(value), readOnly);\n}\n\nfunction createRadiogroupOptionFromValueString(value, readOnly) {\n  return createRadiogroupOption(value, value, readOnly);\n}\n\nfunction getContainedOptions(item, containedResources) {\n  if (!item || !item.answerValueSet) {\n    return undefined;\n  }\n\n  const id = item.answerValueSet.replace('#', '');\n  const resource = getContainedResource(id, containedResources);\n\n  if (!resource) {\n    return undefined;\n  } else if (resource.compose && resource.compose.include) {\n    return getComposedOptions(resource, index_2.isReadOnly(item));\n  } else if (resource.expansion) {\n    return getExpansionOptions(resource, index_2.isReadOnly(item));\n  }\n\n  return undefined;\n}\n\nfunction getComposedOptions(valueSet, disabled) {\n  if (!valueSet.compose || !valueSet.compose.include) {\n    return undefined;\n  }\n\n  const include = valueSet.compose.include;\n\n  if (!include || include.length === 0) {\n    return undefined;\n  }\n\n  const options = [];\n  include.map(i => {\n    if (!i.concept || i.concept.length === 0) {\n      return;\n    }\n\n    i.concept.map(r => {\n      options.push(createRadiogroupOption(String(r.code), String(r.display), disabled));\n    });\n  });\n  return options;\n}\n\nfunction getExpansionOptions(valueSet, disabled) {\n  if (!valueSet.expansion) {\n    return undefined;\n  }\n\n  if (!valueSet.expansion.contains) {\n    return undefined;\n  }\n\n  const options = [];\n  valueSet.expansion.contains.map(r => {\n    options.push(createRadiogroupOption(String(r.code), String(r.display), disabled));\n  });\n  return options;\n}\n\nfunction createRadiogroupOption(type, label, disabled) {\n  return {\n    type: type,\n    label: label,\n    disabled\n  };\n}\n\nfunction getContainedResource(id, containedResources) {\n  if (!containedResources) {\n    return undefined;\n  }\n\n  const resource = containedResources.filter(r => {\n    const valueSet = r;\n    return String(valueSet.id) === id;\n  });\n\n  if (!resource || resource.length === 0) {\n    return undefined;\n  }\n\n  return resource[0];\n}","map":null,"metadata":{},"sourceType":"script"}