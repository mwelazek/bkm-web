{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"/home/teboho/opensrp-fhir-web-source/fhir-web/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\n\nvar _toConsumableArray = require(\"/home/teboho/opensrp-fhir-web-source/fhir-web/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar fhir_1 = require(\"../types/fhir\");\n\nvar itemType_1 = __importDefault(require(\"../constants/itemType\"));\n\nvar enableWhenMatcher_1 = require(\"../util/enableWhenMatcher\");\n\nvar extension_1 = require(\"./extension\");\n\nfunction getRootQuestionnaireResponseItemFromData(definitionLinkId, formData) {\n  if (!formData || !formData.Content) {\n    return undefined;\n  }\n\n  var content = formData.Content;\n\n  if (!content.item || content.item.length === 0) {\n    return undefined;\n  }\n\n  return getItemWithIdFromResponseItemArray(definitionLinkId, content.item);\n}\n\nexports.getRootQuestionnaireResponseItemFromData = getRootQuestionnaireResponseItemFromData;\n\nfunction isInGroupContext(path, item, items) {\n  var pathItem = path && path.find(function (p) {\n    return p.linkId === item.linkId && p.index !== undefined;\n  });\n\n  if (!pathItem) {\n    return true;\n  }\n\n  var repeatingItems = getItemWithIdFromResponseItemArray(item.linkId, items) || [];\n  return repeatingItems.indexOf(item) === pathItem.index;\n}\n\nexports.isInGroupContext = isInGroupContext;\n\nfunction getQuestionnaireResponseItemWithLinkid(linkId, responseItem, referencePath) {\n  if (!responseItem) {\n    return undefined;\n  }\n\n  if (responseItem.linkId === linkId) {\n    return responseItem;\n  }\n\n  for (var i = 0; responseItem.item && i < responseItem.item.length; i++) {\n    if (!isInGroupContext(referencePath, responseItem.item[i], responseItem.item)) {\n      continue;\n    }\n\n    var item = getQuestionnaireResponseItemWithLinkid(linkId, responseItem.item[i], referencePath);\n\n    if (item) {\n      return item;\n    }\n  }\n\n  for (var _i = 0; responseItem.answer && _i < responseItem.answer.length; _i++) {\n    var answer = responseItem.answer[_i];\n\n    for (var j = 0; answer.item && j < answer.item.length; j++) {\n      if (!isInGroupContext(referencePath, answer.item[j], answer.item)) {\n        continue;\n      }\n\n      var _item = getQuestionnaireResponseItemWithLinkid(linkId, answer.item[j], referencePath);\n\n      if (_item) {\n        return _item;\n      }\n    }\n  }\n\n  return undefined;\n}\n\nexports.getQuestionnaireResponseItemWithLinkid = getQuestionnaireResponseItemWithLinkid;\n\nfunction getQuestionnaireResponseItemsWithLinkId(linkId, responseItems) {\n  var _items;\n\n  var recursive = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  if (!responseItems) {\n    return [];\n  }\n\n  var itemsWithLinkId = getItemsWithIdFromResponseItemArray(linkId, responseItems, recursive);\n\n  if (itemsWithLinkId && itemsWithLinkId.length > 0) {\n    return itemsWithLinkId;\n  }\n\n  function collectAnswerItems(items) {\n    var _answers, _subItems, _answers2;\n\n    if (items.length === 0) return [];\n    var answers = [];\n    answers = (_answers = answers).concat.apply(_answers, _toConsumableArray(items.map(function (i) {\n      return i.answer || [];\n    })));\n    var subItems = [];\n    subItems = (_subItems = subItems).concat.apply(_subItems, _toConsumableArray(items.map(function (i) {\n      return i.item || [];\n    })));\n    return (_answers2 = answers).concat.apply(_answers2, _toConsumableArray(collectAnswerItems(subItems)));\n  }\n\n  var answers = collectAnswerItems(responseItems);\n  var items = [];\n  items = (_items = items).concat.apply(_items, _toConsumableArray(answers.map(function (a) {\n    return a.item || [];\n  })));\n  itemsWithLinkId = getItemsWithIdFromResponseItemArray(linkId, items, false);\n  return itemsWithLinkId;\n}\n\nexports.getQuestionnaireResponseItemsWithLinkId = getQuestionnaireResponseItemsWithLinkId;\n\nfunction getArrayContainingResponseItemFromItems(linkId, items) {\n  var _iterator = _createForOfIteratorHelper(items),\n      _step;\n\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var item = _step.value;\n\n      if (item.linkId === linkId) {\n        return items;\n      }\n\n      if (item.item) {\n        var result = getArrayContainingResponseItemFromItems(linkId, item.item);\n        if (result) return result;\n      }\n\n      if (item.answer) {\n        var _result = getArrayContainingResponseItemFromAnswers(linkId, item.answer);\n\n        if (_result) return _result;\n      }\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n\n  return undefined;\n}\n\nexports.getArrayContainingResponseItemFromItems = getArrayContainingResponseItemFromItems;\n\nfunction getArrayContainingResponseItemFromAnswers(linkId, answers) {\n  var _iterator2 = _createForOfIteratorHelper(answers),\n      _step2;\n\n  try {\n    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n      var answer = _step2.value;\n\n      if (answer.item) {\n        var result = getArrayContainingResponseItemFromItems(linkId, answer.item);\n        if (result) return result;\n      }\n    }\n  } catch (err) {\n    _iterator2.e(err);\n  } finally {\n    _iterator2.f();\n  }\n\n  return undefined;\n}\n\nfunction getAnswerFromResponseItem(responseItem) {\n  if (!responseItem) {\n    return undefined;\n  }\n\n  if (!responseItem.answer || responseItem.answer.length === 0) {\n    return undefined;\n  }\n\n  if (responseItem.answer.length > 1) {\n    return responseItem.answer;\n  }\n\n  return responseItem.answer[0];\n}\n\nexports.getAnswerFromResponseItem = getAnswerFromResponseItem;\n\nfunction getResponseItems(formData) {\n  if (!formData || !formData.Content) {\n    return undefined;\n  }\n\n  var response = formData.Content;\n\n  if (!response.item || response.item.length === 0) {\n    return undefined;\n  }\n\n  return response.item;\n}\n\nexports.getResponseItems = getResponseItems;\n\nfunction getDefinitionItems(formDefinition) {\n  if (!formDefinition || !formDefinition.Content) {\n    return undefined;\n  }\n\n  var definition = formDefinition.Content;\n\n  if (!definition.item || definition.item.length === 0) {\n    return undefined;\n  }\n\n  return definition.item;\n}\n\nexports.getDefinitionItems = getDefinitionItems;\n\nfunction getItemWithIdFromResponseItemArray(linkId, responseItems) {\n  if (!responseItems || responseItems.length === 0) {\n    return undefined;\n  }\n\n  var filteredItems = responseItems.filter(function (i) {\n    return i.linkId === linkId;\n  });\n\n  if (!filteredItems || filteredItems.length === 0) {\n    return undefined;\n  }\n\n  return filteredItems;\n}\n\nexports.getItemWithIdFromResponseItemArray = getItemWithIdFromResponseItemArray;\n\nfunction getItemsWithIdFromResponseItemArray(linkId, responseItems) {\n  var recurse = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  if (!responseItems || responseItems.length === 0) {\n    return [];\n  }\n\n  var filteredItems = responseItems.filter(function (i) {\n    return i.linkId === linkId;\n  });\n\n  if (recurse) {\n    var reducer = function reducer(acc, val) {\n      if (val.item) {\n        acc.push.apply(acc, _toConsumableArray(getItemsWithIdFromResponseItemArray(linkId, val.item, recurse)));\n      }\n\n      return acc;\n    };\n\n    return responseItems.reduce(reducer, filteredItems);\n  }\n\n  return filteredItems;\n}\n\nexports.getItemsWithIdFromResponseItemArray = getItemsWithIdFromResponseItemArray;\n\nfunction getItemWithTypeFromArray(type, items) {\n  if (!items || items.length === 0) {\n    return undefined;\n  }\n\n  var filteredItems = [];\n\n  if (type === itemType_1.default.ATTATCHMENT) {\n    filteredItems = items.filter(function (i) {\n      return i.answer && i.answer[0] && i.answer[0].valueAttachment !== null && i.answer[0].valueAttachment !== undefined;\n    });\n  }\n\n  if (!filteredItems || filteredItems.length === 0) {\n    return undefined;\n  }\n\n  return filteredItems;\n}\n\nexports.getItemWithTypeFromArray = getItemWithTypeFromArray;\n\nfunction hasAnswer(answer) {\n  if (!answer) {\n    return false;\n  }\n\n  return hasBooleanAnswer(answer) || hasCodingAnswer(answer) || hasQuantityAnswer(answer) || hasDateAnswer(answer) || hasDateTimeAnswer(answer) || hasDateTimeAnswer(answer) || hasDecimalAnswer(answer) || hasIntegerAnswer(answer) || hasStringAnswer(answer) || hasAttachmentAnswer(answer);\n}\n\nexports.hasAnswer = hasAnswer;\n\nfunction hasBooleanAnswer(answer) {\n  return answer.valueBoolean === true || answer.valueBoolean === false;\n}\n\nexports.hasBooleanAnswer = hasBooleanAnswer;\n\nfunction hasCodingAnswer(answer) {\n  var coding = answer.valueCoding;\n  var codingValue = coding && coding.code ? String(coding.code) : null;\n  return codingValue !== null && codingValue !== undefined && codingValue !== '';\n}\n\nexports.hasCodingAnswer = hasCodingAnswer;\n\nfunction hasQuantityAnswer(answer) {\n  return answer.valueQuantity != null && (!!answer.valueQuantity.value || answer.valueQuantity.value === 0);\n}\n\nexports.hasQuantityAnswer = hasQuantityAnswer;\n\nfunction hasDateAnswer(answer) {\n  return !!answer.valueDate;\n}\n\nexports.hasDateAnswer = hasDateAnswer;\n\nfunction hasDateTimeAnswer(answer) {\n  return !!answer.valueDateTime;\n}\n\nexports.hasDateTimeAnswer = hasDateTimeAnswer;\n\nfunction hasDecimalAnswer(answer) {\n  return !!answer.valueDecimal || answer.valueDecimal === 0;\n}\n\nexports.hasDecimalAnswer = hasDecimalAnswer;\n\nfunction hasIntegerAnswer(answer) {\n  return !!answer.valueInteger || answer.valueInteger === 0;\n}\n\nexports.hasIntegerAnswer = hasIntegerAnswer;\n\nfunction hasStringAnswer(answer) {\n  return !!answer.valueString;\n}\n\nexports.hasStringAnswer = hasStringAnswer;\n\nfunction hasTimeAnswer(answer) {\n  return !!answer.valueTime;\n}\n\nexports.hasTimeAnswer = hasTimeAnswer;\n\nfunction hasAttachmentAnswer(answer) {\n  return answer.valueAttachment != null && !!answer.valueAttachment.id;\n}\n\nexports.hasAttachmentAnswer = hasAttachmentAnswer;\n\nfunction enableWhenMatchesAnswer(enableWhen, answers) {\n  if (!enableWhen) return false;\n  answers = answers || [];\n\n  if (enableWhen.operator === fhir_1.QuestionnaireEnableOperator.Exists.code && enableWhen.answerBoolean === false) {\n    return !answers.some(function (a) {\n      return hasAnswer(a);\n    });\n  }\n\n  if (enableWhen.operator === fhir_1.QuestionnaireEnableOperator.Exists.code && enableWhen.answerBoolean === true) {\n    return answers.some(function (a) {\n      return hasAnswer(a);\n    });\n  }\n\n  if (answers.length === 0) {\n    return false;\n  }\n\n  var matches = false;\n  answers.forEach(function (answer) {\n    matches = matches || enableWhenMatcher_1.enableWhenMatches(enableWhen, answer);\n  });\n  return matches;\n}\n\nexports.enableWhenMatchesAnswer = enableWhenMatchesAnswer;\n\nfunction createIdSuffix(path) {\n  var index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var repeats = arguments.length > 2 ? arguments[2] : undefined;\n  var suffix = '';\n\n  if (path) {\n    path.forEach(function (p) {\n      if (p.index) {\n        suffix += '^' + p.index;\n      }\n    });\n  }\n\n  if (!repeats) return suffix;\n  return suffix + '^' + index;\n}\n\nexports.createIdSuffix = createIdSuffix;\n\nfunction createPathForItem(path, item, responseItem, index) {\n  var newPath;\n\n  if (path === null || path === undefined) {\n    newPath = [];\n  } else {\n    newPath = copyPath(path);\n  }\n\n  index = item.repeats ? index : undefined;\n\n  if (item && responseItem) {\n    newPath.push(Object.assign({\n      linkId: responseItem.linkId\n    }, item.repeats && {\n      index: index\n    }));\n  }\n\n  return newPath;\n}\n\nexports.createPathForItem = createPathForItem;\n\nfunction shouldRenderDeleteButton(item, index) {\n  if (!item.repeats) {\n    return false;\n  }\n\n  if (index === 0) {\n    return false;\n  }\n\n  var minOccurs = extension_1.getMinOccursExtensionValue(item);\n\n  if (minOccurs) {\n    if (index >= minOccurs) {\n      return true;\n    }\n  } else {\n    return true;\n  }\n\n  return false;\n}\n\nexports.shouldRenderDeleteButton = shouldRenderDeleteButton;\n\nfunction copyPath(path) {\n  var newPath = [];\n\n  for (var i = 0; i < path.length; i++) {\n    newPath.push(Object.assign({}, path[i]));\n  }\n\n  return newPath;\n}\n\nfunction getResponseItemAndPathWithLinkId(linkId, item) {\n  var currentPath = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];\n\n  var _a, _b, _c;\n\n  var response = [];\n  var index = 0;\n  var seen = {};\n\n  var _iterator3 = _createForOfIteratorHelper((_a = item.item) !== null && _a !== void 0 ? _a : []),\n      _step3;\n\n  try {\n    for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n      var _i2 = _step3.value;\n      index = _i2.linkId in seen ? seen[_i2.linkId] : 0;\n      response.push.apply(response, _toConsumableArray(getResponseItemAndPathWithLinkIdTraverse(linkId, _i2, currentPath, index)));\n      seen[_i2.linkId] = index + 1;\n    }\n  } catch (err) {\n    _iterator3.e(err);\n  } finally {\n    _iterator3.f();\n  }\n\n  if (isOfTypeQuestionnaireResponseItem(item)) {\n    var _iterator4 = _createForOfIteratorHelper((_b = item.answer) !== null && _b !== void 0 ? _b : []),\n        _step4;\n\n    try {\n      for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n        var a = _step4.value;\n\n        var _iterator5 = _createForOfIteratorHelper((_c = a.item) !== null && _c !== void 0 ? _c : []),\n            _step5;\n\n        try {\n          for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n            var i = _step5.value;\n            index = i.linkId in seen ? seen[i.linkId] : 0;\n            response.push.apply(response, _toConsumableArray(getResponseItemAndPathWithLinkIdTraverse(linkId, i, currentPath, index)));\n            seen[i.linkId] = index + 1;\n          }\n        } catch (err) {\n          _iterator5.e(err);\n        } finally {\n          _iterator5.f();\n        }\n      }\n    } catch (err) {\n      _iterator4.e(err);\n    } finally {\n      _iterator4.f();\n    }\n  }\n\n  return response;\n}\n\nexports.getResponseItemAndPathWithLinkId = getResponseItemAndPathWithLinkId;\n\nfunction getResponseItemAndPathWithLinkIdTraverse(linkId, item, currentPath, currentIndex) {\n  currentPath.push({\n    linkId: item.linkId,\n    index: currentIndex\n  });\n  var response = [];\n\n  if (item.linkId === linkId) {\n    response = [{\n      item: item,\n      path: copyPath(currentPath)\n    }];\n  } else {\n    response = getResponseItemAndPathWithLinkId(linkId, item, currentPath);\n  }\n\n  currentPath.pop();\n  return response;\n}\n\nfunction isOfTypeQuestionnaireResponseItem(item) {\n  return item.answer !== undefined;\n}\n\nfunction getResponseItemWithPath(path, formData) {\n  if (!path || path.length === 0) {\n    return undefined;\n  }\n\n  if (!formData.Content || !formData.Content.item) {\n    return undefined;\n  }\n\n  var rootItems = getRootQuestionnaireResponseItemFromData(path[0].linkId, formData);\n\n  if (!rootItems || rootItems.length === 0) {\n    return undefined;\n  }\n\n  var item = rootItems[path[0].index || 0];\n\n  for (var i = 1; i < path.length; i++) {\n    var itemsWithLinkIdFromPath = getItemWithIdFromResponseItemArray(path[i].linkId, item.item);\n\n    if (!itemsWithLinkIdFromPath || itemsWithLinkIdFromPath.length === 0) {\n      var itemsFromAnswer = item.answer && item.answer.map(function (a) {\n        return a.item;\n      }).reduce(function (a, b) {\n        return (a || []).concat(b || []);\n      });\n      itemsWithLinkIdFromPath = getItemWithIdFromResponseItemArray(path[i].linkId, itemsFromAnswer);\n\n      if (!itemsWithLinkIdFromPath || itemsWithLinkIdFromPath.length === 0) {\n        break;\n      }\n    }\n\n    item = itemsWithLinkIdFromPath[path[i].index || 0];\n  }\n\n  return item;\n}\n\nexports.getResponseItemWithPath = getResponseItemWithPath;\n\nfunction getQuestionnaireDefinitionItem(linkId, definitionItems) {\n  var definitionItem;\n\n  for (var i = 0; definitionItems && i < definitionItems.length; i++) {\n    definitionItem = definitionItems[i];\n\n    if (definitionItem.linkId !== linkId) {\n      definitionItem = getQuestionnaireDefinitionItemWithLinkid(linkId, definitionItems[i]);\n    }\n\n    if (definitionItem === undefined || definitionItem === null) {\n      continue;\n    }\n\n    break;\n  }\n\n  return definitionItem;\n}\n\nexports.getQuestionnaireDefinitionItem = getQuestionnaireDefinitionItem;\n\nfunction getQuestionnaireDefinitionItemWithLinkid(linkId, definitionItem) {\n  var index = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n  if (!definitionItem) {\n    return undefined;\n  }\n\n  var hasItems = definitionItem.item && definitionItem.item.length > 0;\n\n  if (!hasItems) {\n    return undefined;\n  }\n\n  var itemsWithLinkId = getQuestionnaireItemWithIdFromArray(linkId, definitionItem.item);\n\n  if (itemsWithLinkId && itemsWithLinkId.length >= index) {\n    return itemsWithLinkId[index];\n  }\n\n  for (var i = 0; definitionItem.item && i < definitionItem.item.length; i++) {\n    var item = getQuestionnaireDefinitionItemWithLinkid(linkId, definitionItem.item[i]);\n\n    if (item) {\n      return item;\n    }\n  }\n}\n\nfunction getQuestionnaireItemWithIdFromArray(linkId, items) {\n  if (!items || items.length === 0) {\n    return undefined;\n  }\n\n  var filteredItems = items.filter(function (i) {\n    return i.linkId === linkId;\n  });\n\n  if (!filteredItems || filteredItems.length === 0) {\n    return undefined;\n  }\n\n  return filteredItems;\n}","map":null,"metadata":{},"sourceType":"script"}