{"ast":null,"code":"\"use strict\";\n\nvar _toConsumableArray = require(\"/home/teboho/opensrp-fhir-web-source/fhir-web/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\n\nvar _classCallCheck = require(\"/home/teboho/opensrp-fhir-web-source/fhir-web/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\n\nvar _createClass = require(\"/home/teboho/opensrp-fhir-web-source/fhir-web/node_modules/@babel/runtime/helpers/createClass.js\").default;\n\nvar _inherits = require(\"/home/teboho/opensrp-fhir-web-source/fhir-web/node_modules/@babel/runtime/helpers/inherits.js\").default;\n\nvar _createSuper = require(\"/home/teboho/opensrp-fhir-web-source/fhir-web/node_modules/@babel/runtime/helpers/createSuper.js\").default;\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  }\n  result[\"default\"] = mod;\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar React = __importStar(require(\"react\"));\n\nvar classnames_1 = __importDefault(require(\"classnames\"));\n\nvar react_collapse_1 = require(\"react-collapse\");\n\nvar HelpTrigger_1 = __importDefault(require(\"@helsenorge/toolkit/components/icons/HelpTrigger\"));\n\nvar itemcontrol_1 = __importDefault(require(\"../constants/itemcontrol\"));\n\nvar itemType_1 = __importDefault(require(\"../constants/itemType\"));\n\nvar help_1 = require(\"../util/help\");\n\nvar index_1 = require(\"../util/index\");\n\nvar skjemautfyller_core_1 = require(\"../util/skjemautfyller-core\");\n\nvar delete_button_1 = __importDefault(require(\"./formcomponents/repeat/delete-button\"));\n\nvar repeat_button_1 = __importDefault(require(\"./formcomponents/repeat/repeat-button\"));\n\nvar help_button_1 = __importDefault(require(\"./help-button/help-button\"));\n\nfunction withCommonFunctions(WrappedComponent) {\n  return /*#__PURE__*/function (_React$Component) {\n    _inherits(WithCommonFunctions, _React$Component);\n\n    var _super = _createSuper(WithCommonFunctions);\n\n    function WithCommonFunctions(props) {\n      var _this;\n\n      _classCallCheck(this, WithCommonFunctions);\n\n      _this = _super.call(this, props);\n\n      _this.renderDeleteButton = function (className) {\n        if (!_this.props.visibleDeleteButton) {\n          return undefined;\n        }\n\n        var mustShowConfirm = _this.hasAnwer(_this.props.answer);\n\n        if (!mustShowConfirm && _this.props.responseItem && _this.props.responseItem.item) {\n          mustShowConfirm = _this.props.responseItem.item.some(function (item) {\n            return item ? _this.hasAnwer(item.answer) : false;\n          });\n        }\n\n        return React.createElement(\"div\", {\n          className: \"page_skjemautfyller__deletebutton-wrapper\"\n        }, React.createElement(delete_button_1.default, {\n          className: className,\n          item: _this.props.item,\n          path: _this.props.path,\n          resources: _this.props.resources,\n          mustShowConfirm: mustShowConfirm,\n          onAnswerChange: _this.props.onAnswerChange,\n          renderContext: _this.props.renderContext\n        }));\n      };\n\n      _this.renderRepeatButton = function (item, index, path, response) {\n        if (!item.repeats || !index_1.shouldRenderRepeatButton(item, response, index)) {\n          return undefined;\n        }\n\n        return React.createElement(\"div\", {\n          className: \"page_skjemautfyller__repeatbutton-wrapper\"\n        }, React.createElement(repeat_button_1.default, {\n          key: \"item_\".concat(item.linkId, \"_add_repeat_item\"),\n          resources: _this.props.resources,\n          item: item,\n          responseItems: response,\n          parentPath: path,\n          renderContext: _this.props.renderContext\n        }));\n      };\n\n      _this.toggleHelp = function (isOpen) {\n        _this.setState({\n          isHelpVisible: isOpen\n        });\n      };\n\n      _this.renderHelpButton = function () {\n        var _this$props = _this.props,\n            item = _this$props.item,\n            onRequestHelpButton = _this$props.onRequestHelpButton;\n        if (!item) return;\n        var qItem = item;\n        var helpItem = help_1.findHelpItem(qItem);\n        if (!helpItem) return;\n        var helpItemType = help_1.getHelpItemType(helpItem) || itemcontrol_1.default.HELP;\n\n        if (onRequestHelpButton) {\n          return React.createElement(help_button_1.default, {\n            item: helpItem,\n            callback: _this.toggleHelp\n          }, onRequestHelpButton(qItem, helpItem, helpItemType, index_1.getText(helpItem), _this.state.isHelpVisible));\n        }\n\n        return React.createElement(help_button_1.default, {\n          item: helpItem,\n          callback: _this.toggleHelp\n        }, React.createElement(HelpTrigger_1.default, null));\n      };\n\n      _this.renderHelpElement = function () {\n        var _this$props2 = _this.props,\n            item = _this$props2.item,\n            onRequestHelpElement = _this$props2.onRequestHelpElement;\n\n        if (!item) {\n          return;\n        }\n\n        var qItem = item;\n        var helpItem = help_1.findHelpItem(qItem);\n\n        if (!helpItem) {\n          return;\n        }\n\n        var helpItemType = help_1.getHelpItemType(helpItem) || itemcontrol_1.default.HELP;\n\n        if (onRequestHelpElement) {\n          return onRequestHelpElement(qItem, helpItem, helpItemType, index_1.getText(helpItem), _this.state.isHelpVisible);\n        }\n\n        var collapseClasses = classnames_1.default({\n          page_skjemautfyller__helpComponent: true,\n          'page_skjemautfyller__helpComponent--open': _this.state.isHelpVisible\n        });\n        return React.createElement(react_collapse_1.Collapse, {\n          isOpened: _this.state.isHelpVisible\n        }, React.createElement(\"div\", {\n          className: collapseClasses,\n          dangerouslySetInnerHTML: {\n            __html: \"\".concat(index_1.getText(helpItem))\n          }\n        }));\n      };\n\n      _this.renderItem = function (item, renderContext) {\n        var _this$props3 = _this.props,\n            resources = _this$props3.resources,\n            containedResources = _this$props3.containedResources,\n            responseItem = _this$props3.responseItem,\n            pdf = _this$props3.pdf,\n            path = _this$props3.path,\n            headerTag = _this$props3.headerTag,\n            promptLoginMessage = _this$props3.promptLoginMessage,\n            onRenderMarkdown = _this$props3.onRenderMarkdown;\n        if (help_1.isHelpItem(item)) return [];\n        if (index_1.isHiddenItem(item)) return [];\n        var Comp = index_1.getComponentForItem(item.type);\n\n        if (!Comp) {\n          return [];\n        }\n\n        var response;\n\n        if (responseItem) {\n          var childItem = responseItem.item;\n          var childAnswer = responseItem.answer;\n          var linkId = item.linkId;\n\n          if (childItem) {\n            response = skjemautfyller_core_1.getItemWithIdFromResponseItemArray(linkId, childItem);\n          } else if (childAnswer) {\n            response = skjemautfyller_core_1.getItemWithIdFromResponseItemArray(linkId, childAnswer[0].item);\n          }\n        }\n\n        var renderedItems = [];\n\n        if (response && response.length > 0) {\n          response.forEach(function (responseItem, index) {\n            renderedItems.push(React.createElement(Comp, {\n              key: 'item_' + responseItem.linkId + skjemautfyller_core_1.createIdSuffix(path, index, item.repeats),\n              pdf: pdf,\n              language: _this.props.language,\n              includeSkipLink: _this.props.includeSkipLink,\n              promptLoginMessage: promptLoginMessage,\n              id: 'item_' + responseItem.linkId + skjemautfyller_core_1.createIdSuffix(path, index, item.repeats),\n              item: item,\n              responseItem: responseItem,\n              answer: skjemautfyller_core_1.getAnswerFromResponseItem(responseItem),\n              resources: resources,\n              containedResources: containedResources,\n              path: skjemautfyller_core_1.createPathForItem(path, item, responseItem, index),\n              headerTag: index_1.getChildHeaderTag(_this.props.item, headerTag),\n              onValidated: _this.props.onValidated,\n              validateScriptInjection: _this.props.validateScriptInjection,\n              addFormComponent: _this.props.addFormComponent,\n              removeFormComponent: _this.props.removeFormComponent,\n              optionalLabel: _this.props.optionalLabel,\n              requiredLabel: _this.props.requiredLabel,\n              showOptionalLabel: _this.props.showOptionalLabel,\n              showRequiredLabel: _this.props.showRequiredLabel,\n              visibleDeleteButton: skjemautfyller_core_1.shouldRenderDeleteButton(item, index),\n              repeatButton: _this.renderRepeatButton(item, index, path, response),\n              onRequestAttachmentLink: _this.props.onRequestAttachmentLink,\n              onOpenAttachment: _this.props.onOpenAttachment,\n              onDeleteAttachment: _this.props.onDeleteAttachment,\n              uploadAttachment: _this.props.uploadAttachment,\n              onRequestHelpButton: _this.props.onRequestHelpButton,\n              onRequestHelpElement: _this.props.onRequestHelpElement,\n              attachmentErrorMessage: _this.props.attachmentErrorMessage,\n              attachmentMaxFileSize: _this.props.attachmentMaxFileSize,\n              attachmentValidTypes: _this.props.attachmentValidTypes,\n              onAnswerChange: _this.props.onAnswerChange,\n              renderContext: renderContext,\n              onRenderMarkdown: onRenderMarkdown,\n              fetchValueSet: _this.props.fetchValueSet,\n              autoSuggestProps: _this.props.autoSuggestProps\n            }));\n          });\n        }\n\n        return renderedItems;\n      };\n\n      _this.renderChildrenItems = function (renderContext) {\n        var item = _this.props.item;\n\n        if (!item || !item.item) {\n          return undefined;\n        }\n\n        if (item.type === itemType_1.default.GROUP && renderContext.RenderChildren) {\n          return renderContext.RenderChildren(item.item, _this.renderItem);\n        }\n\n        var renderedItems = [];\n        item.item.forEach(function (i) {\n          return renderedItems.push.apply(renderedItems, _toConsumableArray(_this.renderItem(i, renderContext)));\n        });\n        return renderedItems;\n      };\n\n      _this.state = {\n        childComponents: [],\n        isHelpVisible: false\n      };\n      return _this;\n    }\n\n    _createClass(WithCommonFunctions, [{\n      key: \"hasAnwer\",\n      value: function hasAnwer(answer) {\n        return !!answer && Object.keys(answer).length > 0;\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        if (!this.props.enable) {\n          return null;\n        } else {\n          return React.createElement(WrappedComponent, Object.assign({\n            renderChildrenItems: this.renderChildrenItems,\n            renderDeleteButton: this.renderDeleteButton,\n            renderRepeatButton: this.renderRepeatButton,\n            renderHelpButton: this.renderHelpButton,\n            renderHelpElement: this.renderHelpElement,\n            isHelpOpen: this.state.isHelpVisible,\n            onRenderMarkdown: this.props.onRenderMarkdown\n          }, this.props), this.renderChildrenItems(this.props.renderContext));\n        }\n      }\n    }]);\n\n    return WithCommonFunctions;\n  }(React.Component);\n}\n\nexports.default = withCommonFunctions;","map":null,"metadata":{},"sourceType":"script"}