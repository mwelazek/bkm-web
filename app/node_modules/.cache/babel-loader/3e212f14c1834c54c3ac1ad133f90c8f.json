{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst index_1 = __importDefault(require(\"../constants/index\"));\n\nconst itemType_1 = __importDefault(require(\"../constants/itemType\"));\n\nconst status_1 = __importDefault(require(\"../constants/status\"));\n\nconst createQuestionnaireResponseAnswer_1 = require(\"../util/createQuestionnaireResponseAnswer\");\n\nconst extension_1 = require(\"../util/extension\");\n\nfunction generateQuestionnaireResponse(questionnaire) {\n  const response = {\n    resourceType: index_1.default.QUESTIONNAIRE_RESPONSE_RESOURCE_TYPE,\n    status: status_1.default.questionnaireResponse.IN_PROGRESS\n  };\n\n  if (!questionnaire || !questionnaire.item || questionnaire.item.length === 0) {\n    return response;\n  }\n\n  if (questionnaire.url) {\n    response.questionnaire = questionnaire.url;\n  }\n\n  questionnaire.item.forEach(i => {\n    if (!response.item) {\n      response.item = [];\n    }\n\n    for (let j = 0; j < getMinOccurs(i); j++) {\n      const responseItem = createQuestionnaireResponseItem(i);\n      addChildrenItemsToResponseItem(i, responseItem);\n      response.item.push(responseItem);\n    }\n  });\n  return response;\n}\n\nexports.generateQuestionnaireResponse = generateQuestionnaireResponse;\n\nfunction addChildrenItemsToResponseItem(item, response) {\n  if (!item.item || item.item.length === 0) {\n    return;\n  }\n\n  item.item.forEach(i => {\n    for (let j = 0; j < getMinOccurs(i); j++) {\n      const responseItem = createQuestionnaireResponseItem(i);\n      addChildrenItemsToResponseItem(i, responseItem);\n      addResponseItemtoResponse(item, response, responseItem);\n    }\n  });\n}\n\nfunction getMinOccurs(i) {\n  if (i.type === itemType_1.default.ATTATCHMENT) {\n    return 1;\n  }\n\n  const minoccurs = extension_1.getMinOccursExtensionValue(i);\n\n  if (minoccurs && i.repeats) {\n    return minoccurs;\n  }\n\n  return 1;\n}\n\nfunction addResponseItemtoResponse(questionnaireItem, responseItemForQuestionnaire, itemToAdd) {\n  if (questionnaireItem.type === 'group') {\n    if (!responseItemForQuestionnaire.item) {\n      responseItemForQuestionnaire.item = [];\n    }\n\n    responseItemForQuestionnaire.item.push(itemToAdd);\n  } else {\n    if (!responseItemForQuestionnaire.answer) {\n      responseItemForQuestionnaire.answer = [];\n    }\n\n    if (responseItemForQuestionnaire.answer.length === 0) {\n      responseItemForQuestionnaire.answer.push({});\n    }\n\n    const answer = responseItemForQuestionnaire.answer[0];\n\n    if (!answer.item) {\n      answer.item = [];\n    }\n\n    answer.item.push(itemToAdd);\n  }\n}\n\nfunction createQuestionnaireResponseItem(item) {\n  const responseItem = Object.assign({\n    linkId: item.linkId\n  }, item.text && {\n    text: item.text\n  });\n  const answer = createQuestionnaireResponseAnswer_1.createQuestionnaireResponseAnswer(item);\n\n  if (answer) {\n    responseItem.answer = [answer];\n  }\n\n  return responseItem;\n}\n\nexports.createQuestionnaireResponseItem = createQuestionnaireResponseItem;","map":null,"metadata":{},"sourceType":"script"}