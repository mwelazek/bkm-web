{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LocationForm = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _antd = require(\"antd\");\n\nvar _reactRouter = require(\"react-router\");\n\nvar _notifications = require(\"@opensrp/notifications\");\n\nvar _utils = require(\"./utils\");\n\nvar _constants = require(\"../../constants\");\n\nvar _CustomTreeSelect = require(\"./CustomTreeSelect\");\n\nvar _types = require(\"../../helpers/types\");\n\nvar _reactQuery = require(\"react-query\");\n\nvar _mls = require(\"../../mls\");\n\nvar _useDeepCompareEffect = _interopRequireDefault(require(\"use-deep-compare-effect\"));\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      \"default\": obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj[\"default\"] = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nvar FormItem = _antd.Form.Item;\nvar defaultProps = {\n  initialValues: _utils.defaultFormField,\n  successURLGenerator: function successURLGenerator() {\n    return '#';\n  },\n  hidden: [],\n  disabled: [],\n  onCancel: function onCancel() {\n    return undefined;\n  }\n};\nvar formItemLayout = {\n  labelCol: {\n    xs: {\n      span: 24\n    },\n    sm: {\n      span: 4\n    },\n    md: {\n      span: 4\n    },\n    lg: {\n      span: 6\n    }\n  },\n  wrapperCol: {\n    xs: {\n      span: 24\n    },\n    sm: {\n      span: 18\n    },\n    md: {\n      span: 16\n    },\n    lg: {\n      span: 14\n    }\n  }\n};\nvar tailLayout = {\n  wrapperCol: {\n    xs: {\n      offset: 0,\n      span: 16\n    },\n    sm: {\n      offset: 12,\n      span: 24\n    },\n    md: {\n      offset: 8,\n      span: 16\n    },\n    lg: {\n      offset: 6,\n      span: 14\n    }\n  }\n};\n\nvar LocationForm = function LocationForm(props) {\n  var _tree$first;\n\n  var initialValues = props.initialValues,\n      disabled = props.disabled,\n      hidden = props.hidden,\n      disabledTreeNodesCallback = props.disabledTreeNodesCallback,\n      fhirBaseURL = props.fhirBaseURL,\n      afterSubmit = props.afterSubmit,\n      successURLGenerator = props.successURLGenerator,\n      onCancel = props.onCancel,\n      tree = props.tree;\n  var isEditMode = !!initialValues.id;\n  var defaultParentNode = (_tree$first = tree.first(function (node) {\n    return node.model.nodeId === initialValues.parentId;\n  })) !== null && _tree$first !== void 0 ? _tree$first : tree;\n\n  var _useState = (0, _react.useState)(false),\n      _useState2 = (0, _slicedToArray2[\"default\"])(_useState, 2),\n      isSubmitting = _useState2[0],\n      setSubmitting = _useState2[1];\n\n  var _useState3 = (0, _react.useState)(defaultParentNode),\n      _useState4 = (0, _slicedToArray2[\"default\"])(_useState3, 2),\n      parentNode = _useState4[0],\n      setParentNode = _useState4[1];\n\n  var _useState5 = (0, _react.useState)(false),\n      _useState6 = (0, _slicedToArray2[\"default\"])(_useState5, 2),\n      areWeDoneHere = _useState6[0],\n      setAreWeDoneHere = _useState6[1];\n\n  var _useState7 = (0, _react.useState)(),\n      _useState8 = (0, _slicedToArray2[\"default\"])(_useState7, 2),\n      successUrl = _useState8[0],\n      setSuccessUrl = _useState8[1];\n\n  var queryClient = (0, _reactQuery.useQueryClient)();\n\n  var _useTranslation = (0, _mls.useTranslation)(),\n      t = _useTranslation.t;\n\n  var validationRules = (0, _utils.validationRulesFactory)(t);\n\n  var isHidden = function isHidden(fieldName) {\n    return hidden.includes(fieldName);\n  };\n\n  var _Form$useForm = _antd.Form.useForm(),\n      _Form$useForm2 = (0, _slicedToArray2[\"default\"])(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  (0, _useDeepCompareEffect[\"default\"])(function () {\n    form.resetFields();\n  }, [form, initialValues]);\n  var status = [{\n    label: t('Active'),\n    value: _types.LocationUnitStatus.ACTIVE\n  }, {\n    label: t('Inactive'),\n    value: _types.LocationUnitStatus.INACTIVE\n  }];\n  var locationCategoryOptions = [{\n    label: t('Jurisdiction'),\n    value: true\n  }, {\n    label: t('Building'),\n    value: false\n  }];\n\n  if (areWeDoneHere && successUrl) {\n    return _react[\"default\"].createElement(_reactRouter.Redirect, {\n      to: successUrl\n    });\n  }\n\n  return _react[\"default\"].createElement(\"div\", {\n    className: \"location-form form-container\"\n  }, _react[\"default\"].createElement(_antd.Form, (0, _extends2[\"default\"])({}, formItemLayout, {\n    form: form,\n    name: \"location-form\",\n    scrollToFirstError: true,\n    initialValues: initialValues,\n    onFinish: function () {\n      var _ref = (0, _asyncToGenerator2[\"default\"])(_regenerator[\"default\"].mark(function _callee(values) {\n        var payload, successMessage;\n        return _regenerator[\"default\"].wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                setSubmitting(true);\n                payload = (0, _utils.generateLocationUnit)(values, initialValues, parentNode);\n                successMessage = isEditMode ? t(\"Location was successfully updated\") : t('Location was successfully created');\n                (0, _utils.postPutLocationUnit)(payload, fhirBaseURL).then(function () {\n                  var successUrl = successURLGenerator(payload);\n                  (0, _notifications.sendSuccessNotification)(successMessage);\n                  afterSubmit === null || afterSubmit === void 0 ? void 0 : afterSubmit(payload);\n                  queryClient.cancelQueries([_constants.locationHierarchyResourceType])[\"catch\"](function (err) {\n                    throw err;\n                  });\n                  queryClient.invalidateQueries({\n                    predicate: function predicate(query) {\n                      return [_constants.locationResourceType, _constants.locationHierarchyResourceType].includes(query.queryKey[0]);\n                    }\n                  })[\"catch\"](function (err) {\n                    throw err;\n                  });\n                  setSuccessUrl(successUrl);\n                  setAreWeDoneHere(true);\n                })[\"catch\"](function (err) {\n                  (0, _notifications.sendErrorNotification)(err.message);\n                })[\"finally\"](function () {\n                  setSubmitting(false);\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }()\n  }), _react[\"default\"].createElement(FormItem, {\n    name: \"id\",\n    label: t('Id'),\n    rules: validationRules.id,\n    hidden: true,\n    id: \"id\"\n  }, _react[\"default\"].createElement(_antd.Input, {\n    disabled: true\n  })), _react[\"default\"].createElement(FormItem, {\n    id: \"parentId\",\n    hidden: isHidden('parentId'),\n    label: t('Part Of'),\n    name: \"parentId\",\n    rules: validationRules.parentId\n  }, _react[\"default\"].createElement(_CustomTreeSelect.CustomTreeSelect, {\n    disabled: disabled.includes('parentId'),\n    dropdownStyle: {\n      maxHeight: 400,\n      overflow: 'auto'\n    },\n    placeholder: t('Select the parent location'),\n    disabledTreeNodesCallback: disabledTreeNodesCallback,\n    fullDataCallback: setParentNode,\n    tree: tree,\n    allowClear: true\n  })), _react[\"default\"].createElement(FormItem, {\n    id: \"name\",\n    rules: validationRules.name,\n    hidden: isHidden('name'),\n    name: \"name\",\n    label: t('Name'),\n    hasFeedback: true\n  }, _react[\"default\"].createElement(_antd.Input, {\n    disabled: disabled.includes('name'),\n    placeholder: t('Enter a location name')\n  })), _react[\"default\"].createElement(FormItem, {\n    id: \"alias\",\n    hidden: isHidden('alias'),\n    name: \"alias\",\n    label: t('Alias'),\n    hasFeedback: true\n  }, _react[\"default\"].createElement(_antd.Input, {\n    disabled: disabled.includes('description'),\n    placeholder: t('Alias')\n  })), _react[\"default\"].createElement(FormItem, {\n    id: \"status\",\n    rules: validationRules.status,\n    hidden: isHidden('status'),\n    label: t('Status'),\n    name: \"status\"\n  }, _react[\"default\"].createElement(_antd.Radio.Group, {\n    name: \"active\"\n  }, status.map(function (e) {\n    return _react[\"default\"].createElement(_antd.Radio, {\n      name: \"status\",\n      key: e.label,\n      value: e.value\n    }, e.label);\n  }))), _react[\"default\"].createElement(FormItem, {\n    hidden: isHidden('isJurisdiction'),\n    label: t('Physical type'),\n    name: \"isJurisdiction\",\n    id: \"isJurisdiction\",\n    rules: validationRules.isJurisdiction\n  }, _react[\"default\"].createElement(_antd.Radio.Group, {\n    disabled: disabled.includes('isJurisdiction'),\n    options: locationCategoryOptions\n  })), _react[\"default\"].createElement(FormItem, {\n    id: \"description\",\n    rules: validationRules.description,\n    hidden: isHidden('description'),\n    name: \"description\",\n    label: t('Description'),\n    hasFeedback: true\n  }, _react[\"default\"].createElement(_antd.Input.TextArea, {\n    rows: 4,\n    disabled: disabled.includes('description'),\n    placeholder: t('Description')\n  })), _react[\"default\"].createElement(FormItem, tailLayout, _react[\"default\"].createElement(_antd.Space, null, _react[\"default\"].createElement(_antd.Button, {\n    type: \"primary\",\n    id: \"location-form-submit-button\",\n    disabled: isSubmitting,\n    htmlType: \"submit\"\n  }, isSubmitting ? t('Saving') : t('Save')), _react[\"default\"].createElement(_antd.Button, {\n    id: \"location-form-cancel-button\",\n    onClick: onCancel\n  }, t('Cancel'))))));\n};\n\nexports.LocationForm = LocationForm;\nLocationForm.defaultProps = defaultProps;","map":null,"metadata":{},"sourceType":"script"}