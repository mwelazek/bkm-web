{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof = require(\"@babel/runtime/helpers/typeof\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ValueSection = exports.Value = exports.DownloadLink = exports.DocTitle = exports.DocPropertyDisplay = exports.Coding = void 0;\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));\n\nvar _antd = require(\"antd\");\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _utils = require(\"./utils\");\n\nvar _reactUtils = require(\"@opensrp/react-utils\");\n\nvar _reactQuery = require(\"react-query\");\n\nvar _icons = require(\"@ant-design/icons\");\n\nvar _mls = require(\"../../../mls\");\n\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\n\nfunction _interopRequireWildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      \"default\": obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache(nodeInterop);\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj[\"default\"] = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nvar ValueSection = function ValueSection(props) {\n  var dataTestId = props.dataTestId,\n      label = props.label,\n      children = props.children;\n  return _react[\"default\"].createElement(\"div\", {\n    className: \"fhir-ui__ValueSection\",\n    \"data-testid\": dataTestId\n  }, _react[\"default\"].createElement(\"label\", {\n    className: \"fhir-ui__ValueSection-label\"\n  }, label), _react[\"default\"].createElement(\"div\", {\n    className: \"fhir-ui__ValueSection-body\"\n  }, children));\n};\n\nexports.ValueSection = ValueSection;\n\nvar Value = function Value(props) {\n  var dataTestId = props.dataTestId,\n      children = props.children,\n      label = props.label;\n  return _react[\"default\"].createElement(\"div\", {\n    className: \"fhir-ui__Value\"\n  }, _react[\"default\"].createElement(\"label\", {\n    className: \"fhir-ui__Value-label\"\n  }, label), _react[\"default\"].createElement(\"div\", {\n    \"data-testid\": dataTestId\n  }, children));\n};\n\nexports.Value = Value;\n\nvar DocTitle = function DocTitle(_ref) {\n  var title = _ref.title,\n      status = _ref.status;\n  return _react[\"default\"].createElement(_react[\"default\"].Fragment, null, title, \"\\xA0\\xA0\", status ? _react[\"default\"].createElement(_antd.Tag, null, _react[\"default\"].createElement(\"span\", {\n    title: \"status\"\n  }), status) : null);\n};\n\nexports.DocTitle = DocTitle;\n\nvar Coding = function Coding(props) {\n  var coding = props.coding;\n  var display = (0, _lodash.get)(coding, 'display', '');\n  var code = (0, _lodash.get)(coding, 'code', '');\n  var system = (0, _lodash.get)(coding, 'system', '');\n  var hasAdditionalInfo = code || system;\n\n  if (!code && !display) {\n    return null;\n  }\n\n  return _react[\"default\"].createElement(\"div\", {\n    className: \"fhir-datatype__Coding\"\n  }, display && _react[\"default\"].createElement(_react[\"default\"].Fragment, null, _react[\"default\"].createElement(\"span\", {\n    className: \"fhir-datatype__Coding__title\"\n  }, display), \" \\xA0\"), hasAdditionalInfo && _react[\"default\"].createElement(\"span\", {\n    className: \"fhir-datatype__Coding__code\",\n    title: system\n  }, \"(\", code, \")\"));\n};\n\nexports.Coding = Coding;\n\nvar DocPropertyDisplay = function DocPropertyDisplay(props) {\n  var _ref2, _parsedDoc$title, _parsedDoc$title2;\n\n  var parsedDoc = props.parsedDoc,\n      fhirBaseUrl = props.fhirBaseUrl;\n\n  var _useTranslation = (0, _mls.useTranslation)(),\n      t = _useTranslation.t;\n\n  var contentColumns = getColumns(fhirBaseUrl, (_ref2 = (_parsedDoc$title = parsedDoc.title) !== null && _parsedDoc$title !== void 0 ? _parsedDoc$title : parsedDoc.id) !== null && _ref2 !== void 0 ? _ref2 : '', t);\n  return _react[\"default\"].createElement(\"div\", {\n    className: \"doc-prop-display\"\n  }, parsedDoc.title && _react[\"default\"].createElement(\"h4\", {\n    className: \"doc-resource__title\"\n  }, _react[\"default\"].createElement(DocTitle, {\n    title: (_parsedDoc$title2 = parsedDoc.title) !== null && _parsedDoc$title2 !== void 0 ? _parsedDoc$title2 : parsedDoc.id,\n    status: parsedDoc.status\n  })), _react[\"default\"].createElement(\"div\", null, !(0, _utils.itemIsEmpty)(parsedDoc.documentType.codeList) && _react[\"default\"].createElement(Value, {\n    label: t('Document type')\n  }, _react[\"default\"].createElement(Coding, {\n    coding: parsedDoc.documentType.code\n  })), !(0, _utils.itemIsEmpty)(parsedDoc.securityCodes.codeList) && _react[\"default\"].createElement(Value, {\n    label: t('Security label')\n  }, _react[\"default\"].createElement(Coding, {\n    coding: parsedDoc.securityCodes.code\n  })), parsedDoc.createdAt && _react[\"default\"].createElement(Value, {\n    label: t('Created at')\n  }, _react[\"default\"].createElement(\"span\", null, parsedDoc.createdAt)), !(0, _utils.itemIsEmpty)(parsedDoc.context) && _react[\"default\"].createElement(_react[\"default\"].Fragment, null, _react[\"default\"].createElement(ValueSection, {\n    label: t('Context')\n  }, !(0, _utils.itemIsEmpty)(parsedDoc.context.eventCoding) && _react[\"default\"].createElement(Value, {\n    label: t('Event'),\n    \"data-testid\": \"context.event\"\n  }, _react[\"default\"].createElement(Coding, {\n    coding: parsedDoc.context.eventCoding\n  })), !(0, _utils.itemIsEmpty)(parsedDoc.context.facilityTypeCoding) && _react[\"default\"].createElement(Value, {\n    label: t('Facility'),\n    \"data-testid\": \"context.facilityType\"\n  }, _react[\"default\"].createElement(Coding, {\n    coding: parsedDoc.context.facilityTypeCoding\n  })), !(0, _utils.itemIsEmpty)(parsedDoc.context.practiceSettingCoding) && _react[\"default\"].createElement(Value, {\n    label: t('Practice Setting'),\n    \"data-testid\": \"context.practiceSetting\"\n  }, _react[\"default\"].createElement(Coding, {\n    coding: parsedDoc.context.practiceSettingCoding\n  })), (parsedDoc.context.periodStart || parsedDoc.context.periodEnd) && _react[\"default\"].createElement(Value, {\n    label: t('Period'),\n    \"data-testid\": \"context.period\"\n  }, parsedDoc.context.periodStart, \" - \", parsedDoc.context.periodEnd))), _react[\"default\"].createElement(ValueSection, {\n    label: \"Content\"\n  }, _react[\"default\"].createElement(\"div\", {\n    className: \"doc-resource__content_table\"\n  }, _react[\"default\"].createElement(_reactUtils.TableLayout, {\n    datasource: parsedDoc.content,\n    columns: contentColumns,\n    pagination: false\n  })))));\n};\n\nexports.DocPropertyDisplay = DocPropertyDisplay;\n\nvar getColumns = function getColumns(fhirBaseUrl, docTitle, t) {\n  return [{\n    title: t('S.no'),\n    render: function SerialNumber(_, __, index) {\n      return _react[\"default\"].createElement(\"span\", null, Number(index) + 1);\n    }\n  }, {\n    title: t('Name'),\n    dataIndex: 'formatDisplay'\n  }, {\n    title: t('Format'),\n    dataIndex: 'formatCode'\n  }, {\n    className: 'doc-resource__content-table-action',\n    title: t('Preview/Download'),\n    render: function ActionRender(fullObj) {\n      var attachment = fullObj.attachment,\n          formatContentType = fullObj.formatContentType,\n          formatCode = fullObj.formatCode;\n\n      if (!formatContentType) {\n        return null;\n      }\n\n      var _splitContentType = (0, _utils.splitContentType)(formatContentType),\n          discretePart = _splitContentType.discretePart;\n\n      var imgSrcB64Prefix = \"data:\".concat(formatContentType, \";base64,\");\n      var filename = \"\".concat(docTitle, \".\").concat(formatCode);\n      var imgSrc = \"\".concat(imgSrcB64Prefix, \" \").concat(attachment.data);\n\n      switch (discretePart) {\n        case 'image':\n          return _react[\"default\"].createElement(\"img\", {\n            alt: docTitle,\n            src: imgSrc\n          });\n      }\n\n      if (attachment.binaryUrl) {\n        return _react[\"default\"].createElement(_react[\"default\"].Fragment, null, _react[\"default\"].createElement(DownloadLink, {\n          filename: filename,\n          linkToResource: attachment === null || attachment === void 0 ? void 0 : attachment.binaryUrl,\n          fhirBaseUrl: fhirBaseUrl\n        }));\n      }\n    }\n  }];\n};\n\nvar DownloadLink = function DownloadLink(props) {\n  var linkToResource = props.linkToResource,\n      fhirBaseUrl = props.fhirBaseUrl,\n      filename = props.filename;\n\n  var _useQuery = (0, _reactQuery.useQuery)(linkToResource, function () {\n    return (0, _utils.fetchAttachmentForDownload)(fhirBaseUrl, linkToResource);\n  }, {\n    retry: false\n  }),\n      isLoading = _useQuery.isLoading,\n      data = _useQuery.data,\n      isError = _useQuery.isError;\n\n  var _React$useState = _react[\"default\"].useState(),\n      _React$useState2 = (0, _slicedToArray2[\"default\"])(_React$useState, 2),\n      dataUrl = _React$useState2[0],\n      setDataUrl = _React$useState2[1];\n\n  (0, _react.useEffect)(function () {\n    if (data) {\n      var dUrl = URL.createObjectURL(data);\n      setDataUrl(dUrl);\n      return function () {\n        URL.revokeObjectURL(dUrl);\n      };\n    }\n  }, [data]);\n  return _react[\"default\"].createElement(_react[\"default\"].Fragment, null, _react[\"default\"].createElement(\"a\", {\n    download: filename,\n    className: isLoading || isError ? 'disabled-link' : '',\n    href: dataUrl\n  }, \"Download\"), \"\\xA0\\xA0\", isLoading && _react[\"default\"].createElement(_icons.SyncOutlined, {\n    spin: true\n  }));\n};\n\nexports.DownloadLink = DownloadLink;","map":null,"metadata":{},"sourceType":"script"}